<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Astrologer Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f6f6f8;height:100vh;display:flex}
.sidebar{width:300px;background:#fff;padding:12px;border-right:1px solid #ddd}
.session{padding:10px;border-radius:8px;margin-bottom:8px;cursor:pointer;background:#fafafa}
.chat{flex:1;display:flex;flex-direction:column}
.chatBody{flex:1;padding:14px;overflow-y:auto}
.msg{background:#fff;padding:10px 12px;border-radius:12px;margin-bottom:8px;max-width:70%}
.controls{padding:12px;display:flex;gap:8px}
input{flex:1;padding:10px;border-radius:20px}
button{padding:10px 16px;border-radius:20px;background:#f8cfa7;border:none;font-weight:700}
</style>
</head>

<body>

<div class="sidebar">
  <h3>Sessions</h3>
  <div id="sessions"></div>
</div>

<div class="chat">
  <div id="chatBody" class="chatBody"></div>
  <div class="controls">
    <input id="reply" placeholder="Replyâ€¦" />
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:  "AIzaSyBPOzL5ZoYd0NelkDNYk0LGBPDYVT2Tqew",
  authDomain: "connect-astro-e5309.firebaseapp.com",
  projectId: "connect-astro-e5309"
});
const db=firebase.firestore();

let activeSession=null;

// Load sessions
db.collection("sessions")
 .where("astrologerId","==","Gautam")
 .onSnapshot(snap=>{
   const box=document.getElementById("sessions");
   box.innerHTML="";
   snap.forEach(d=>{
     const div=document.createElement("div");
     div.className="session";
     div.textContent=d.id;
     div.onclick=()=>openSession(d.id);
     box.appendChild(div);
   });
 });

// Open chat
function openSession(id){
 activeSession=id;
 db.collection("sessions").doc(id)
  .collection("messages")
  .orderBy("createdAt")
  .onSnapshot(snap=>{
    const chat=document.getElementById("chatBody");
    chat.innerHTML="";
    snap.forEach(d=>{
      const m=d.data();
      const div=document.createElement("div");
      div.className="msg";
      div.textContent=m.text;
      chat.appendChild(div);
    });
    chat.scrollTop=chat.scrollHeight;
  });
}

// Send reply
function send(){
 if(!activeSession)return;
 const input=document.getElementById("reply");
 const text=input.value.trim();
 if(!text)return;
 input.value="";
 db.collection("sessions").doc(activeSession)
  .collection("messages").add({
    sender:"astrologer",
    text,
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });
}
</script>

</body>
</html>
